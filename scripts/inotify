#!/system/bin/sh

# ==============================================================================
# Flux Module Toggle Listener (inotify)
# Description: Monitor Magisk disable file for module toggle
# Standalone script - no dependencies
# ==============================================================================

SCRIPT_DIR="${SCRIPT_DIR:-$(dirname "$(readlink -f "$0")")}"
START_SCRIPT="$SCRIPT_DIR/start"

# ==============================================================================
# [ Event Handler ]
# ==============================================================================

main() {
    local events="${1:-}"
    local monitor_dir="${2:-}"
    local monitor_file="${3:-}"

    # Only handle 'disable' file events
    [ "$monitor_file" != "disable" ] && return 0

    case "$events" in
        d)  # disable file deleted -> Module Enabled -> Start
            sh "$START_SCRIPT" start
            ;;
        n)  # disable file created -> Module Disabled -> Stop
            sh "$START_SCRIPT" stop
            ;;
    esac
}

main "$@"
