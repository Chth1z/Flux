#!/system/bin/sh

# ==============================================================================
# Flux Service Manager (start)
# Description: Manual entry point for service control
# Note: Primary control is via Magisk toggle (inotifyd), this is for manual use
# ==============================================================================

SCRIPT_DIR="$(dirname "$(readlink -f "$0")")"
. "$SCRIPT_DIR/const"
. "$SCRIPT_DIR/log"

export LOG_COMPONENT="Service"

case "${1:-}" in
    start)
        log_info "Manual start requested"
        sh "$INIT_SCRIPT"
        ;;
    stop)
        log_info "Manual stop requested"
        # Simulate disable by creating file temporarily
        sh "$CORE_SCRIPT" stop &
        sh "$TPROXY_SCRIPT" stop &
        sh "$MONITOR_SCRIPT" stop &
        wait
        rm -f "$EVENTS_DIR/fail" "$EVENTS_DIR/core_ok" "$EVENTS_DIR/tproxy_ok" 2>/dev/null
        sync_prop "STOPPED"
        prop_clear
        ;;
    *)
        echo "Usage: $0 {start|stop}"
        exit 1
        ;;
esac
